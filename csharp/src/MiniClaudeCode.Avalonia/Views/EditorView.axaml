<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MiniClaudeCode.Avalonia.ViewModels"
             xmlns:models="using:MiniClaudeCode.Avalonia.Models"
             xmlns:ae="using:AvaloniaEdit"
             xmlns:conv="using:MiniClaudeCode.Avalonia.Converters"
             xmlns:local="using:MiniClaudeCode.Avalonia.Views"
             x:Class="MiniClaudeCode.Avalonia.Views.EditorView"
             x:DataType="vm:EditorViewModel">

    <UserControl.Resources>
        <conv:BoolToOpacityConverter x:Key="BoolOpacity" />
    </UserControl.Resources>

    <Border Background="#1E1E2E">
        <DockPanel>
            <!-- Tab bar -->
            <Border DockPanel.Dock="Top"
                    Background="#181825"
                    BorderBrush="#313244"
                    BorderThickness="0,0,0,1"
                    IsVisible="{Binding HasOpenFiles}">
                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding Tabs}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:EditorTab">
                                <Border Padding="0"
                                        BorderBrush="#313244"
                                        BorderThickness="0,0,1,0"
                                        Cursor="Hand">
                                    <Border.Styles>
                                        <Style Selector="Border">
                                            <Setter Property="Background" Value="#181825" />
                                        </Style>
                                        <Style Selector="Border:pointerover">
                                            <Setter Property="Background" Value="#1E1E2E" />
                                        </Style>
                                    </Border.Styles>
                                    <DockPanel>
                                        <!-- Close button -->
                                        <Button DockPanel.Dock="Right"
                                                Content="\u2715"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                FontSize="9"
                                                Padding="4,0,6,0"
                                                Foreground="#6C7086"
                                                Command="{Binding $parent[ItemsControl].((vm:EditorViewModel)DataContext).CloseTabCommand}"
                                                CommandParameter="{Binding}"
                                                VerticalAlignment="Center"
                                                Cursor="Hand">
                                            <Button.Styles>
                                                <Style Selector="Button:pointerover">
                                                    <Setter Property="Foreground" Value="#CDD6F4" />
                                                </Style>
                                            </Button.Styles>
                                        </Button>

                                        <!-- Tab content (clickable to activate) -->
                                        <Button Background="Transparent"
                                                BorderThickness="0"
                                                Padding="10,6"
                                                Cursor="Hand"
                                                Tag="{Binding}"
                                                Click="OnTabClick">
                                            <TextBlock Text="{Binding DisplayTitle}"
                                                       FontSize="12"
                                                       Foreground="#CDD6F4"
                                                       Opacity="{Binding IsActive, Converter={StaticResource BoolOpacity}}"
                                                       VerticalAlignment="Center" />
                                        </Button>
                                    </DockPanel>

                                    <!-- Active tab indicator (bottom border) -->
                                    <!-- Using a top border workaround: active tabs get brighter background -->
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Breadcrumbs -->
            <Border DockPanel.Dock="Top"
                    Padding="10,3"
                    Background="#1E1E2E"
                    BorderBrush="#313244"
                    BorderThickness="0,0,0,1"
                    IsVisible="{Binding HasOpenFiles}">
                <TextBlock Text="{Binding Breadcrumb}"
                           FontSize="11"
                           Foreground="#9CA3AF"
                           Opacity="0.7" />
            </Border>

            <!-- Editor content area -->
            <Panel>
                <!-- Welcome screen when no files are open -->
                <StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="12"
                            IsVisible="{Binding !HasOpenFiles}">
                    <TextBlock Text="MiniClaudeCode"
                               FontSize="28"
                               FontWeight="Light"
                               Foreground="#CDD6F4"
                               Opacity="0.2"
                               HorizontalAlignment="Center" />
                    <StackPanel Spacing="6" Opacity="0.25" HorizontalAlignment="Center">
                        <TextBlock Text="Ctrl+Shift+P   Command Palette"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                        <TextBlock Text="Ctrl+P         Quick Open File"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                        <TextBlock Text="Ctrl+Shift+E   Toggle Explorer"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                        <TextBlock Text="Ctrl+Shift+G   Source Control"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                        <TextBlock Text="Ctrl+`         Toggle Terminal"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                        <TextBlock Text="Ctrl+K         Inline Edit"
                                   FontSize="12" Foreground="#6C7086"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                    </StackPanel>
                </StackPanel>

                <!-- AvaloniaEdit Text Editor -->
                <ae:TextEditor x:Name="CodeEditor"
                               IsVisible="{Binding HasOpenFiles}"
                               FontFamily="Cascadia Code, Consolas, Menlo, monospace"
                               FontSize="13"
                               Foreground="#CDD6F4"
                               Background="#1E1E2E"
                               ShowLineNumbers="True"
                               WordWrap="False"
                               HorizontalScrollBarVisibility="Auto"
                               VerticalScrollBarVisibility="Auto" />

                <!-- Inline Edit Panel (overlay) -->
                <local:InlineEditView DataContext="{Binding InlineEdit}" />
            </Panel>
        </DockPanel>
    </Border>
</UserControl>
