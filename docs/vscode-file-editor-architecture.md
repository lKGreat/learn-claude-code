# VSCode ä»£ç ç¼–è¾‘å™¨æ–‡ä»¶ç®¡ç†æ¶æ„è¯¦è§£

> æœ¬æ–‡æ¡£æ·±å…¥åˆ†æ Visual Studio Code çš„æ–‡ä»¶æ‰“å¼€ã€ç¼–è¾‘å’Œç®¡ç†æœºåˆ¶ï¼Œé‡ç‚¹å…³æ³¨å·¥ä½œåŒºæ–‡ä»¶ç®¡ç†ï¼ˆEXPLORERæ¨¡å—ï¼‰çš„å®ç°é€»è¾‘ã€‚

---

## ç›®å½•

1. [æ•´ä½“æ¶æ„æ¦‚è§ˆ](#1-æ•´ä½“æ¶æ„æ¦‚è§ˆ)
2. [è¿›ç¨‹æ¨¡å‹ä¸é€šä¿¡æœºåˆ¶](#2-è¿›ç¨‹æ¨¡å‹ä¸é€šä¿¡æœºåˆ¶)
3. [æ ¸å¿ƒæœåŠ¡å±‚è®¾è®¡](#3-æ ¸å¿ƒæœåŠ¡å±‚è®¾è®¡)
4. [æ–‡ä»¶æ ‘ç»“æ„è®¾è®¡ï¼ˆEXPLORERæ¨¡å—ï¼‰](#4-æ–‡ä»¶æ ‘ç»“æ„è®¾è®¡exploreræ¨¡å—)
5. [æ–‡ä»¶çŠ¶æ€è·Ÿè¸ªæœºåˆ¶](#5-æ–‡ä»¶çŠ¶æ€è·Ÿè¸ªæœºåˆ¶)
6. [æ–‡ä»¶æ‰“å¼€æµç¨‹è¯¦è§£](#6-æ–‡ä»¶æ‰“å¼€æµç¨‹è¯¦è§£)
7. [æ–‡ä»¶ç¼–è¾‘ä¸ä¿å­˜æµç¨‹](#7-æ–‡ä»¶ç¼–è¾‘ä¸ä¿å­˜æµç¨‹)
8. [æ–‡ä»¶å…³é—­æµç¨‹è¯¦è§£](#8-æ–‡ä»¶å…³é—­æµç¨‹è¯¦è§£)
9. [å…³é”®æ¥å£å®šä¹‰](#9-å…³é”®æ¥å£å®šä¹‰)
10. [æ•°æ®æµç¤ºæ„å›¾](#10-æ•°æ®æµç¤ºæ„å›¾)

---

## 1. æ•´ä½“æ¶æ„æ¦‚è§ˆ

### 1.1 æŠ€æœ¯æ ˆ

VSCode åŸºäº **Electron** æ¡†æ¶æ„å»ºï¼Œæ ¸å¿ƒæŠ€æœ¯æ ˆåŒ…æ‹¬ï¼š

| æŠ€æœ¯ç»„ä»¶ | è¯´æ˜ |
|---------|------|
| Electron | è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶ï¼Œæ•´åˆ Chromium + Node.js |
| TypeScript | ä¸»å¼€å‘è¯­è¨€ï¼Œæä¾›ç±»å‹å®‰å…¨ |
| Monaco Editor | æ ¸å¿ƒä»£ç ç¼–è¾‘å™¨ç»„ä»¶ |
| Service Layer | ä¾èµ–æ³¨å…¥æ¨¡å¼çš„æœåŠ¡æ¶æ„ |

### 1.2 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Workbench Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Explorer  â”‚  â”‚   Editor    â”‚  â”‚   Search    â”‚  ...        â”‚
â”‚  â”‚    View     â”‚  â”‚   Groups    â”‚  â”‚    View     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        Platform Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ FileService â”‚  â”‚EditorServiceâ”‚  â”‚WorkspaceSvc â”‚  ...        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          Base Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Events    â”‚  â”‚   Lifecycle â”‚  â”‚    Utils    â”‚  ...        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æºç ç›®å½•ç»“æ„

```
src/vs/
â”œâ”€â”€ base/                    # åŸºç¡€å±‚ï¼šé€šç”¨å·¥å…·ã€äº‹ä»¶ç³»ç»Ÿã€ç”Ÿå‘½å‘¨æœŸ
â”‚   â”œâ”€â”€ browser/            # æµè§ˆå™¨ç›¸å…³åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ common/             # å¹³å°æ— å…³çš„é€šç”¨ä»£ç 
â”‚   â”œâ”€â”€ node/               # Node.js ç‰¹å®šå®ç°
â”‚   â””â”€â”€ test/               # æµ‹è¯•æ¡†æ¶
â”‚
â”œâ”€â”€ platform/               # å¹³å°å±‚ï¼šæ ¸å¿ƒæœåŠ¡å®šä¹‰ä¸å®ç°
â”‚   â”œâ”€â”€ files/              # æ–‡ä»¶ç³»ç»ŸæœåŠ¡
â”‚   â”œâ”€â”€ workspace/          # å·¥ä½œåŒºæœåŠ¡
â”‚   â”œâ”€â”€ editor/             # ç¼–è¾‘å™¨æœåŠ¡
â”‚   â”œâ”€â”€ configuration/      # é…ç½®æœåŠ¡
â”‚   â””â”€â”€ instantiation/      # ä¾èµ–æ³¨å…¥æ¡†æ¶
â”‚
â”œâ”€â”€ editor/                 # Monaco ç¼–è¾‘å™¨æ ¸å¿ƒ
â”‚   â”œâ”€â”€ browser/            # ç¼–è¾‘å™¨æµè§ˆå™¨å®ç°
â”‚   â”œâ”€â”€ common/             # ç¼–è¾‘å™¨æ¨¡å‹ï¼ˆTextModelç­‰ï¼‰
â”‚   â””â”€â”€ contrib/            # ç¼–è¾‘å™¨åŠŸèƒ½æ‰©å±•
â”‚
â””â”€â”€ workbench/              # å·¥ä½œå°å±‚ï¼šç”¨æˆ·ç•Œé¢ç»„ä»¶
    â”œâ”€â”€ browser/            # æµè§ˆå™¨ç«¯UIç»„ä»¶
    â”‚   â”œâ”€â”€ parts/          # UIéƒ¨ä»¶ï¼ˆExplorer, Editor, Terminalç­‰ï¼‰
    â”‚   â””â”€â”€ services/       # å·¥ä½œå°çº§æœåŠ¡
    â””â”€â”€ common/             # å·¥ä½œå°é€šç”¨é€»è¾‘
```

---

## 2. è¿›ç¨‹æ¨¡å‹ä¸é€šä¿¡æœºåˆ¶

### 2.1 å¤šè¿›ç¨‹æ¶æ„

VSCode é‡‡ç”¨ Electron çš„å¤šè¿›ç¨‹æ¶æ„ï¼Œå¯åŠ¨æ—¶åˆ›å»ºå¤šä¸ªç‹¬ç«‹è¿›ç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Main Process                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†                                         â”‚   â”‚
â”‚  â”‚ â€¢ åŸç”Ÿçª—å£åˆ›å»ºä¸ç®¡ç†                                       â”‚   â”‚
â”‚  â”‚ â€¢ æ–‡ä»¶ç³»ç»Ÿç›‘è§†æœåŠ¡ (FileWatcher)                          â”‚   â”‚
â”‚  â”‚ â€¢ èœå•å’Œå¯¹è¯æ¡†ç®¡ç†                                         â”‚   â”‚
â”‚  â”‚ â€¢ IPC é€šä¿¡åè°ƒä¸­å¿ƒ                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Renderer Processâ”‚  â”‚ Extension Host  â”‚  â”‚ Watcher Service â”‚
â”‚   (Main Window) â”‚  â”‚    Process      â”‚  â”‚    Process      â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚ â€¢ UIæ¸²æŸ“        â”‚  â”‚ â€¢ æ‰©å±•APIè¿è¡Œ   â”‚  â”‚ â€¢ æ–‡ä»¶ç³»ç»Ÿç›‘è§†  â”‚
â”‚ â€¢ Monacoç¼–è¾‘å™¨  â”‚  â”‚ â€¢ è¯­è¨€æœåŠ¡å™¨    â”‚  â”‚ â€¢ å˜æ›´äº‹ä»¶å‘å¸ƒ  â”‚
â”‚ â€¢ Workbenchç»„ä»¶ â”‚  â”‚ â€¢ è°ƒè¯•é€‚é…å™¨    â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   IPC Channel     â”‚
                    â”‚   (Protocol)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è¿›ç¨‹èŒè´£è¯¦è§£

| è¿›ç¨‹ç±»å‹ | èŒè´£ | å…³é”®æœåŠ¡ |
|---------|------|---------|
| **Main Process** | åº”ç”¨å…¥å£ã€çª—å£ç®¡ç†ã€åŸç”Ÿå¯¹è¯æ¡† | `IWindowsMainService`, `FileWatcher` |
| **Renderer Process** | UIæ¸²æŸ“ã€ç¼–è¾‘å™¨ã€ç”¨æˆ·äº¤äº’ | `IEditorService`, `IExplorerService` |
| **Extension Host** | æ‰©å±•æ‰§è¡Œã€è¯­è¨€æœåŠ¡å™¨ | `ExtHostExtensionService` |
| **Watcher Service** | æ–‡ä»¶ç³»ç»Ÿå˜æ›´ç›‘è§† | `FileWatcher` |

### 2.3 IPC é€šä¿¡æœºåˆ¶

VSCode ä½¿ç”¨è‡ªå®šä¹‰çš„ IPC Protocol è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼š

```typescript
// IPC åè®®æ ¸å¿ƒæ¥å£
interface IMainProcess {
  // ä¸»è¿›ç¨‹ -> æ¸²æŸ“è¿›ç¨‹ï¼šå¹¿æ’­äº‹ä»¶
  broadcast(channel: string, data: any): void;
  
  // æ¸²æŸ“è¿›ç¨‹ -> ä¸»è¿›ç¨‹ï¼šè°ƒç”¨æœåŠ¡æ–¹æ³•
  call<T>(channel: string, command: string, ...args: any[]): Promise<T>;
}

// é€šä¿¡ç¤ºä¾‹ï¼šæ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†
// æ¸²æŸ“è¿›ç¨‹å‘èµ·è¯·æ±‚
const result = await ipcRenderer.call('dialog', 'showOpenDialog', options);
```

---

## 3. æ ¸å¿ƒæœåŠ¡å±‚è®¾è®¡

### 3.1 ä¾èµ–æ³¨å…¥æ¡†æ¶

VSCode ä½¿ç”¨ **æœåŠ¡å®šä½å™¨æ¨¡å¼** å’Œ **ä¾èµ–æ³¨å…¥** ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼š

```typescript
// æœåŠ¡è£…é¥°å™¨
export const IFileService = createDecorator<IFileService>('fileService');

// æœåŠ¡å®šä¹‰
export interface IFileService {
  _serviceBrand: undefined;
  
  // äº‹ä»¶
  onDidFilesChange: Event<FileChangesEvent>;
  
  // æ–¹æ³•
  resolveContent(resource: URI): Promise<IContent>;
  writeFile(resource: URI, content: string): Promise<void>;
}

// æœåŠ¡æ³¨å†Œ
services.set(IFileService, new SyncDescriptor(FileService));
```

### 3.2 æ ¸å¿ƒæœåŠ¡å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Workspace Services                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ IWorkspaceContext â”‚  â”‚  IConfiguration   â”‚                   â”‚
â”‚  â”‚     Service       â”‚  â”‚     Service       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     File Services                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   IFileService    â”‚  â”‚ ITextFileService  â”‚                   â”‚
â”‚  â”‚ (æ–‡ä»¶ç³»ç»Ÿæ“ä½œ)    â”‚  â”‚ (æ–‡æœ¬æ–‡ä»¶ç®¡ç†)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ IBackupFileServiceâ”‚  â”‚ IResolveFileServiceâ”‚                  â”‚
â”‚  â”‚ (å¤‡ä»½ç®¡ç†)        â”‚  â”‚ (æ–‡ä»¶è§£æ)        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Editor Services                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  IEditorService   â”‚  â”‚IEditorGroupsServiceâ”‚                  â”‚
â”‚  â”‚ (ç¼–è¾‘å™¨æ§åˆ¶)      â”‚  â”‚ (ç¼–è¾‘å™¨ç»„ç®¡ç†)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ITextModelService â”‚  â”‚ ICodeEditorService â”‚                   â”‚
â”‚  â”‚ (æ–‡æœ¬æ¨¡å‹ç®¡ç†)    â”‚  â”‚ (ä»£ç ç¼–è¾‘å™¨)      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Model Services                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ ITextModelService â”‚  â”‚IModelService      â”‚                   â”‚
â”‚  â”‚ (æ¨¡å‹åˆ›å»º/ç¼“å­˜)   â”‚  â”‚ (æ¨¡å‹æ³¨å†Œ)        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…³é”®æœåŠ¡è¯´æ˜

#### IFileServiceï¼ˆæ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼‰

```typescript
export interface IFileService {
  // æ–‡ä»¶å˜æ›´äº‹ä»¶
  readonly onDidFilesChange: Event<FileChangesEvent>;
  
  // è§£ææ–‡ä»¶å†…å®¹
  resolveContent(resource: URI, options?: IResolveContentOptions): Promise<IStreamContent>;
  
  // å†™å…¥æ–‡ä»¶
  writeFile(resource: URI, value: string | ITextSnapshot, options?: IWriteTextFileOptions): Promise<void>;
  
  // åˆ›å»ºæ–‡ä»¶
  createFile(resource: URI, options?: ICreateFileOptions): Promise<IFileStat>;
  
  // åˆ é™¤æ–‡ä»¶
  del(resource: URI, options?: IDeleteFileOptions): Promise<void>;
  
  // è§£ææ–‡ä»¶çŠ¶æ€
  resolve(resource: URI, options?: IResolveFileOptions): Promise<IFileStat>;
  
  // æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  exists(resource: URI): Promise<boolean>;
}
```

#### ITextFileServiceï¼ˆæ–‡æœ¬æ–‡ä»¶æœåŠ¡ï¼‰

```typescript
export interface ITextFileService {
  // è„æ–‡ä»¶å˜æ›´äº‹ä»¶
  readonly onDidChangeDirty: Event<TextFileModelChangeEvent>;
  
  // ä¿å­˜äº‹ä»¶
  readonly onDidSave: Event<TextFileSaveEvent>;
  
  // æ–‡ä»¶æ‰“å¼€äº‹ä»¶
  readonly onDidLoad: Event<TextFileLoadEvent>;
  
  // è·å–æ–‡æœ¬æ–‡ä»¶æ¨¡å‹
  models: ITextFileEditorModelManager;
  
  // ä¿å­˜æ–‡ä»¶
  save(resource: URI, options?: ISaveOptions): Promise<boolean>;
  
  // å¦å­˜ä¸º
  saveAs(resource: URI, target?: URI, options?: ISaveOptions): Promise<boolean>;
  
  // è¿˜åŸæ–‡ä»¶
  revert(resource: URI, options?: IRevertOptions): Promise<boolean>;
  
  // è·å–è„æ–‡ä»¶åˆ—è¡¨
  getDirty(resources?: URI[]): URI[];
}
```

#### IEditorServiceï¼ˆç¼–è¾‘å™¨æœåŠ¡ï¼‰

```typescript
export interface IEditorService {
  // æ´»åŠ¨ç¼–è¾‘å™¨
  readonly activeEditor: IEditorInput | undefined;
  
  // ç¼–è¾‘å™¨æ‰“å¼€äº‹ä»¶
  readonly onDidOpenEditor: Event<IEditorIdentifier>;
  
  // ç¼–è¾‘å™¨å…³é—­äº‹ä»¶
  readonly onDidCloseEditor: Event<IEditorCloseEvent>;
  
  // æ‰“å¼€ç¼–è¾‘å™¨
  openEditor(editor: IEditorInput, options?: IEditorOptions): Promise<IEditorPane | undefined>;
  
  // å…³é—­ç¼–è¾‘å™¨
  closeEditor(editor: IEditorInput): Promise<void>;
}
```

---

## 4. æ–‡ä»¶æ ‘ç»“æ„è®¾è®¡ï¼ˆEXPLORERæ¨¡å—ï¼‰

### 4.1 Explorer ç»„ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ExplorerViewlet                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ViewContainer                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                 ExplorerView                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚           ExplorerService                     â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ æ–‡ä»¶æ ‘æ•°æ®ç®¡ç†                             â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ èŠ‚ç‚¹çŠ¶æ€ç»´æŠ¤                               â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ äº‹ä»¶åˆ†å‘                                   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                       â”‚                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                       â–¼                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚         FileNavigationNG                     â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ è™šæ‹ŸåŒ–åˆ—è¡¨æ¸²æŸ“                            â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ æ‡’åŠ è½½èŠ‚ç‚¹                                â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ å¯è®¿é—®æ€§æ”¯æŒ                              â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ–‡ä»¶æ ‘æ•°æ®æ¨¡å‹

```typescript
// æ–‡ä»¶æ ‘èŠ‚ç‚¹æ¥å£
interface IExplorerNode {
  // èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†
  readonly id: string;
  
  // èµ„æºURI
  readonly resource: URI;
  
  // èŠ‚ç‚¹åç§°
  readonly name: string;
  
  // æ˜¯å¦ä¸ºç›®å½•
  readonly isDirectory: boolean;
  
  // å­èŠ‚ç‚¹ï¼ˆæ‡’åŠ è½½ï¼‰
  readonly children: IExplorerNode[];
  
  // çˆ¶èŠ‚ç‚¹
  readonly parent: IExplorerNode | undefined;
  
  // å±•å¼€çŠ¶æ€
  isExpanded: boolean;
  
  // é€‰æ‹©çŠ¶æ€
  isSelected: boolean;
}

// æ–‡ä»¶æ ‘çŠ¶æ€
interface IExplorerViewState {
  // æ ¹èŠ‚ç‚¹åˆ—è¡¨
  rootNodes: IExplorerNode[];
  
  // é€‰ä¸­çš„èŠ‚ç‚¹
  selectedNodes: IExplorerNode[];
  
  // å±•å¼€çš„ç›®å½•
  expandedNodes: Set<string>;
  
  // ç„¦ç‚¹èŠ‚ç‚¹
  focusedNode: IExplorerNode | undefined;
}
```

### 4.3 æ–‡ä»¶æ ‘æ¸²æŸ“ç­–ç•¥

VSCode ä½¿ç”¨ **è™šæ‹ŸåŒ–åˆ—è¡¨** å’Œ **æ‡’åŠ è½½** ä¼˜åŒ–å¤§å‹é¡¹ç›®çš„æ€§èƒ½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Virtual List Rendering                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Viewport (å¯è§åŒºåŸŸ)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ node_modules  â”‚  â† æ¸²æŸ“é¡¹                          â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ src           â”‚                                     â”‚   â”‚
â”‚  â”‚  â”‚   ğŸ“ components  â”‚                                     â”‚   â”‚
â”‚  â”‚  â”‚   ğŸ“ utils       â”‚                                     â”‚   â”‚
â”‚  â”‚  â”‚   ğŸ“„ main.ts     â”‚                                     â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ dist          â”‚                                     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  è™šæ‹ŸåŒ–åŸç†ï¼š                                                    â”‚
â”‚  â€¢ åªæ¸²æŸ“å¯è§åŒºåŸŸçš„èŠ‚ç‚¹                                          â”‚
â”‚  â€¢ æ»šåŠ¨æ—¶åŠ¨æ€å›æ”¶å’Œå¤ç”¨DOMå…ƒç´                                    â”‚
â”‚  â€¢ ä½¿ç”¨ç»å¯¹å®šä½è®¡ç®—èŠ‚ç‚¹ä½ç½®                                      â”‚
â”‚  â€¢ æ”¯æŒæ•°ä¸‡èŠ‚ç‚¹çš„æµç•…æ»šåŠ¨                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 æ–‡ä»¶æ ‘äº‹ä»¶å¤„ç†

```typescript
// Explorer äº‹ä»¶ç±»å‹
enum ExplorerEventType {
  NODE_CLICK = 'nodeClick',           // å•å‡»é€‰ä¸­
  NODE_DOUBLE_CLICK = 'nodeDoubleClick', // åŒå‡»æ‰“å¼€
  NODE_CONTEXT_MENU = 'nodeContextMenu', // å³é”®èœå•
  NODE_COLLAPSE = 'nodeCollapse',     // æŠ˜å ç›®å½•
  NODE_EXPAND = 'nodeExpand',         // å±•å¼€ç›®å½•
  NODE_RENAME = 'nodeRename',         // é‡å‘½å
  NODE_DELETE = 'nodeDelete',         // åˆ é™¤
  NODE_DRAG_START = 'nodeDragStart',  // æ‹–æ‹½å¼€å§‹
  NODE_DROP = 'nodeDrop',             // æ‹–æ”¾
}

// äº‹ä»¶å¤„ç†å™¨
interface IExplorerEventHandler {
  handleEvent(event: ExplorerEvent): void;
}

// å•å‡»äº‹ä»¶å¤„ç†æµç¨‹
class NodeClickHandler implements IExplorerEventHandler {
  handleEvent(event: ExplorerEvent): void {
    // 1. æ›´æ–°é€‰ä¸­çŠ¶æ€
    this.explorerService.setSelectedNodes([event.node]);
    
    // 2. å¦‚æœæ˜¯ç›®å½•ï¼Œåˆ‡æ¢å±•å¼€çŠ¶æ€
    if (event.node.isDirectory) {
      this.explorerService.toggleNodeExpansion(event.node);
    }
    
    // 3. å¦‚æœæ˜¯æ–‡ä»¶ä¸”å•å‡»é¢„è§ˆæ¨¡å¼å¼€å¯ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­é¢„è§ˆ
    if (!event.node.isDirectory && this.config.singleClickPreview) {
      this.editorService.openEditor({
        resource: event.node.resource,
        options: { preview: true }
      });
    }
  }
}
```

---

## 5. æ–‡ä»¶çŠ¶æ€è·Ÿè¸ªæœºåˆ¶

### 5.1 æ–‡ä»¶çŠ¶æ€ç±»å‹

```typescript
// æ–‡ä»¶çŠ¶æ€æšä¸¾
enum FileState {
  SAVED = 'saved',           // å·²ä¿å­˜
  DIRTY = 'dirty',           // å·²ä¿®æ”¹æœªä¿å­˜
  CONFLICT = 'conflict',     // å­˜åœ¨å†²çªï¼ˆå¤–éƒ¨ä¿®æ”¹ï¼‰
  ORPHAN = 'orphan',         // æ–‡ä»¶å·²åˆ é™¤
  ERROR = 'error',           // é”™è¯¯çŠ¶æ€
}

// æ–‡ä»¶çŠ¶æ€ä¿¡æ¯
interface IFileStateInfo {
  resource: URI;
  state: FileState;
  
  // è„çŠ¶æ€ç›¸å…³
  dirty?: boolean;
  modifiedTime?: number;
  
  // ç‰ˆæœ¬ä¿¡æ¯
  versionId?: number;
  
  // å†²çªä¿¡æ¯
  conflictInfo?: {
    localContent: string;
    remoteContent: string;
    localModifiedTime: number;
    remoteModifiedTime: number;
  };
}
```

### 5.2 çŠ¶æ€è·Ÿè¸ªæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   File State Tracking Flow                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ File Opened  â”‚â”€â”€â”€â”€â–¶â”‚ Model Createdâ”‚â”€â”€â”€â”€â–¶â”‚ State: SAVED â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                    â”‚             â”‚
â”‚                                                    â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ User Types   â”‚â”€â”€â”€â”€â–¶â”‚ Model Changedâ”‚â”€â”€â”€â”€â–¶â”‚ State: DIRTY â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ (Event:      â”‚     â”‚ (Event:      â”‚    â”‚
â”‚                       â”‚  onDidChange)â”‚     â”‚ onDidChange- â”‚    â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ Dirty)       â”‚    â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                    â”‚             â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚             â”‚
â”‚                       â”‚ User Saves   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                       â”‚ File Written â”‚                          â”‚
â”‚                       â”‚ (Event:      â”‚                          â”‚
â”‚                       â”‚  onDidSave)  â”‚                          â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                       â”‚ State: SAVED â”‚                          â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è„çŠ¶æ€æ£€æµ‹

```typescript
// TextFileModel è„çŠ¶æ€ç®¡ç†
class TextFileModel {
  private _dirty: boolean = false;
  private savedVersionId: number = 0;
  private currentVersionId: number = 0;
  
  // æ–‡æœ¬å†…å®¹å˜æ›´ç›‘å¬
  private onTextContentChanged(): void {
    this.currentVersionId++;
    
    // æ£€æŸ¥æ˜¯å¦å˜è„
    if (this.currentVersionId !== this.savedVersionId) {
      if (!this._dirty) {
        this._dirty = true;
        this._onDidChangeDirty.fire({ resource: this.resource, dirty: true });
      }
    }
  }
  
  // ä¿å­˜å®Œæˆ
  private onDidSave(): void {
    this.savedVersionId = this.currentVersionId;
    this._dirty = false;
    this._onDidChangeDirty.fire({ resource: this.resource, dirty: false });
  }
}
```

### 5.4 å¤–éƒ¨ä¿®æ”¹æ£€æµ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 External Change Detection                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                File Watcher (Main Process)                â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  ç›‘è§†å·¥ä½œåŒºå†…æ‰€æœ‰æ–‡ä»¶çš„å˜æ›´ï¼š                              â”‚   â”‚
â”‚  â”‚  â€¢ æ–°å»ºæ–‡ä»¶ (ADD)                                         â”‚   â”‚
â”‚  â”‚  â€¢ åˆ é™¤æ–‡ä»¶ (DELETE)                                      â”‚   â”‚
â”‚  â”‚  â€¢ ä¿®æ”¹æ–‡ä»¶ (UPDATE)                                      â”‚   â”‚
â”‚  â”‚  â€¢ é‡å‘½åæ–‡ä»¶ (RENAME)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ FileChangesEventâ”‚                          â”‚
â”‚                    â”‚ å¹¿æ’­åˆ°æ¸²æŸ“è¿›ç¨‹  â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TextFileService (Renderer)                   â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  æ£€æŸ¥å·²æ‰“å¼€æ–‡ä»¶æ˜¯å¦å—å½±å“ï¼š                                â”‚   â”‚
â”‚  â”‚  â€¢ å¦‚æœæ–‡ä»¶å·²æ‰“å¼€ä¸”æœ‰æœªä¿å­˜çš„ä¿®æ”¹ â†’ è§¦å‘å†²çªå¤„ç†           â”‚   â”‚
â”‚  â”‚  â€¢ å¦‚æœæ–‡ä»¶å·²æ‰“å¼€ä¸”æ— ä¿®æ”¹ â†’ è‡ªåŠ¨é‡è½½                       â”‚   â”‚
â”‚  â”‚  â€¢ å¦‚æœæ–‡ä»¶æœªæ‰“å¼€ â†’ å¿½ç•¥æˆ–åˆ·æ–°Explorer                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚   Conflict Resolution Dialog  â”‚                  â”‚
â”‚              â”‚   â€¢ Compare with file on disk â”‚                  â”‚
â”‚              â”‚   â€¢ Overwrite                 â”‚                  â”‚
â”‚              â”‚   â€¢ Revert                    â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. æ–‡ä»¶æ‰“å¼€æµç¨‹è¯¦è§£

### 6.1 æ‰“å¼€æ–‡ä»¶å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     File Open Flow                               â”‚
â”‚                                                                  â”‚
â”‚  ç”¨æˆ·æ“ä½œ                                                         â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”‚ åŒå‡»æ–‡ä»¶ / Ctrl+P / å‘½ä»¤é¢æ¿                               â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ExplorerService / CommandService                      â”‚   â”‚
â”‚  â”‚    è§¦å‘ openFile å‘½ä»¤                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. IEditorService.openEditor()                           â”‚   â”‚
â”‚  â”‚    å‚æ•°ï¼šresource, options                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â”‚                                       â”‚                   â”‚
â”‚     â–¼                                       â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ åˆ›å»ºEditorInput â”‚              â”‚ è·å–EditorGroup â”‚          â”‚
â”‚  â”‚ (FileEditorInput)â”‚             â”‚ (å½“å‰æ´»åŠ¨ç»„)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚     â”‚                                       â”‚                   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. EditorGroup.openEditor(input, options)                â”‚   â”‚
â”‚  â”‚    æ£€æŸ¥ï¼šæ˜¯å¦å·²æ‰“å¼€ï¼Ÿé¢„è§ˆæ¨¡å¼ï¼Ÿåˆ†ç»„ç­–ç•¥ï¼Ÿ                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. TextFileService.resolve(resource)                     â”‚   â”‚
â”‚  â”‚    ä»ç£ç›˜è¯»å–æ–‡ä»¶å†…å®¹                                     â”‚   â”‚
â”‚  â”‚    æˆ–ä»ç¼“å­˜è·å–                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5. ITextModelService.createModel()                       â”‚   â”‚
â”‚  â”‚    åˆ›å»º ITextModel å®ä¾‹                                   â”‚   â”‚
â”‚  â”‚    è®¾ç½®è¯­è¨€æ¨¡å¼ã€ç¼–ç                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 6. CodeEditorWidget åˆ›å»º                                  â”‚   â”‚
â”‚  â”‚    å…³è” TextModel                                         â”‚   â”‚
â”‚  â”‚    åˆå§‹åŒ– Monaco Editor                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 7. æ›´æ–° Tab æ                                             â”‚   â”‚
â”‚  â”‚    æ·»åŠ /æ¿€æ´» Tab                                          â”‚   â”‚
â”‚  â”‚    æ›´æ–°é¢åŒ…å±‘å¯¼èˆª                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 8. è§¦å‘äº‹ä»¶                                               â”‚   â”‚
â”‚  â”‚    onDidOpenEditor, onDidChangeActiveEditor              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ ¸å¿ƒä»£ç æµç¨‹

```typescript
// ç®€åŒ–çš„æ–‡ä»¶æ‰“å¼€æµç¨‹
class EditorService implements IEditorService {
  
  async openEditor(options: IOpenEditorOptions): Promise<IEditorPane | undefined> {
    // 1. è§£æèµ„æº
    const resource = options.resource;
    
    // 2. åˆ›å»ºç¼–è¾‘å™¨è¾“å…¥
    const input = this.instantiationService.createInstance(
      FileEditorInput,
      resource,
      undefined,
      undefined
    );
    
    // 3. è·å–ç›®æ ‡ç¼–è¾‘å™¨ç»„
    const targetGroup = options.group ?? this.activeGroup;
    
    // 4. æ‰“å¼€ç¼–è¾‘å™¨
    return targetGroup.openEditor(input, options.options);
  }
}

// ç¼–è¾‘å™¨ç»„æ‰“å¼€ç¼–è¾‘å™¨
class EditorGroup {
  
  async openEditor(input: IEditorInput, options?: IEditorOptions): Promise<IEditorPane | undefined> {
    // 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    const existingEditor = this.findEditor(input);
    if (existingEditor) {
      // æ¿€æ´»ç°æœ‰ç¼–è¾‘å™¨
      return this.activateEditor(existingEditor);
    }
    
    // 2. å¤„ç†é¢„è§ˆæ¨¡å¼
    if (options?.preview && this.previewEditor) {
      // æ›¿æ¢é¢„è§ˆç¼–è¾‘å™¨
      return this.replacePreviewEditor(input);
    }
    
    // 3. åˆ›å»ºæ–°çš„ç¼–è¾‘å™¨å®ä¾‹
    const editorPane = await this.createEditorPane(input);
    
    // 4. æ·»åŠ åˆ°ç¼–è¾‘å™¨åˆ—è¡¨
    this.editors.push({ input, pane: editorPane });
    
    // 5. è§¦å‘äº‹ä»¶
    this._onDidOpenEditor.fire({ editor: input, groupId: this.id });
    
    return editorPane;
  }
}
```

### 6.3 TextModel åˆ›å»ºæµç¨‹

```typescript
// TextModel æœåŠ¡
class TextModelService implements ITextModelService {
  
  async createModel(resource: URI): Promise<ITextModel> {
    // 1. æ£€æŸ¥ç¼“å­˜
    const cached = this.modelCache.get(resource.toString());
    if (cached) {
      return cached;
    }
    
    // 2. è¯»å–æ–‡ä»¶å†…å®¹
    const content = await this.textFileService.read(resource);
    
    // 3. æ£€æµ‹è¯­è¨€æ¨¡å¼
    const languageId = await this.detectLanguage(resource, content.value);
    
    // 4. åˆ›å»º TextModel
    const model = this.createTextModel(
      resource,
      content.value,
      languageId,
      content.encoding
    );
    
    // 5. ç¼“å­˜æ¨¡å‹
    this.modelCache.set(resource.toString(), model);
    
    // 6. è®¾ç½®æ¨¡å‹é”€æ¯æ—¶çš„æ¸…ç†
    model.onWillDispose(() => {
      this.modelCache.delete(resource.toString());
    });
    
    return model;
  }
}
```

---

## 7. æ–‡ä»¶ç¼–è¾‘ä¸ä¿å­˜æµç¨‹

### 7.1 ç¼–è¾‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     File Edit Flow                               â”‚
â”‚                                                                  â”‚
â”‚  ç”¨æˆ·è¾“å…¥                                                         â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Monaco Editor è¾“å…¥å¤„ç†                                    â”‚   â”‚
â”‚  â”‚ â€¢ é”®ç›˜äº‹ä»¶æ•è·                                           â”‚   â”‚
â”‚  â”‚ â€¢ è¾“å…¥æ³•å¤„ç†                                             â”‚   â”‚
â”‚  â”‚ â€¢ å‰ªè´´æ¿å¤„ç†                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ITextModel åº”ç”¨ç¼–è¾‘                                       â”‚   â”‚
â”‚  â”‚ â€¢ applyEdit() æ–¹æ³•è°ƒç”¨                                   â”‚   â”‚
â”‚  â”‚ â€¢ å•æ­¥ç¼–è¾‘æˆ–æ‰¹é‡ç¼–è¾‘                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å†…éƒ¨ç¼–è¾‘æ“ä½œ                                              â”‚   â”‚
â”‚  â”‚ â€¢ åˆ›å»º EditOperation                                     â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–°ç¼“å†²åŒº (PieceTreeTextBuffer)                       â”‚   â”‚
â”‚  â”‚ â€¢ è®¡ç®—å·®å¼‚                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â”‚                                       â”‚                   â”‚
â”‚     â–¼                                       â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ äº‹ä»¶è§¦å‘        â”‚              â”‚ Undo/Redo æ ˆ    â”‚          â”‚
â”‚  â”‚ onDidChangeContentâ”‚            â”‚ è®°å½•ç¼–è¾‘å†å²    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ TextFileModel ç›‘å¬å˜æ›´                                    â”‚   â”‚
â”‚  â”‚ â€¢ æ£€æŸ¥æ˜¯å¦å˜è„                                           â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–°ç‰ˆæœ¬ID                                             â”‚   â”‚
â”‚  â”‚ â€¢ è§¦å‘ onDidChangeDirty äº‹ä»¶                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ UI æ›´æ–°                                                   â”‚   â”‚
â”‚  â”‚ â€¢ Tab æ ‡é¢˜æ˜¾ç¤ºä¿®æ”¹æ ‡è®° (â—)                               â”‚   â”‚
â”‚  â”‚ â€¢ æ–‡ä»¶æ ‘æ˜¾ç¤º M çŠ¶æ€                                      â”‚   â”‚
â”‚  â”‚ â€¢ æ ‡é¢˜æ æ˜¾ç¤ºå·²ä¿®æ”¹                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ä¿å­˜æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     File Save Flow                               â”‚
â”‚                                                                  â”‚
â”‚  ç”¨æˆ·è§¦å‘ä¿å­˜ (Ctrl+S / è‡ªåŠ¨ä¿å­˜ / å…³é—­æ—¶ä¿å­˜)                    â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. ITextFileService.save(resource)                       â”‚   â”‚
â”‚  â”‚    æˆ– saveAll()                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. è·å– TextFileEditorModel                              â”‚   â”‚
â”‚  â”‚    models.get(resource)                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. æ‰§è¡Œä¿å­˜å‰é’©å­                                         â”‚   â”‚
â”‚  â”‚ â€¢ æ ¼å¼åŒ–ä»£ç  (å¯é€‰)                                      â”‚   â”‚
â”‚  â”‚ â€¢ è§¦å‘ onWillSave äº‹ä»¶                                   â”‚   â”‚
â”‚  â”‚ â€¢ æ‰©å±•å¯ä»¥ä¿®æ”¹å†…å®¹                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. åˆ›å»ºå¤‡ä»½æ–‡ä»¶                                           â”‚   â”‚
â”‚  â”‚ â€¢ .vscode/backup/xxx.backup                              â”‚   â”‚
â”‚  â”‚ â€¢ é˜²æ­¢ä¿å­˜å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤±                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5. IFileService.writeFile()                              â”‚   â”‚
â”‚  â”‚    æ¸²æŸ“è¿›ç¨‹ â†’ IPC â†’ ä¸»è¿›ç¨‹ â†’ æ–‡ä»¶ç³»ç»Ÿ                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚                   â”‚                   â”‚                  â”‚
â”‚     â–¼                   â–¼                   â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æˆåŠŸ     â”‚     â”‚ å¤±è´¥     â”‚     â”‚ å†²çª     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚     â”‚                   â”‚                   â”‚                  â”‚
â”‚     â–¼                   â–¼                   â–¼                  â”‚
â”‚  æ›´æ–°çŠ¶æ€         æ˜¾ç¤ºé”™è¯¯         è§£å†³å†²çª                    â”‚
â”‚  æ¸…é™¤è„æ ‡è®°       å›æ»šå¤‡ä»½         åˆå¹¶/è¦†ç›–                    â”‚
â”‚     â”‚                   â”‚                   â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 6. è§¦å‘ onDidSave äº‹ä»¶                                    â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–° savedVersionId                                    â”‚   â”‚
â”‚  â”‚ â€¢ æ¸…é™¤ dirty æ ‡è®°                                        â”‚   â”‚
â”‚  â”‚ â€¢ é€šçŸ¥ Git æœåŠ¡                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 7. UI æ›´æ–°                                                â”‚   â”‚
â”‚  â”‚ â€¢ ç§»é™¤ Tab ä¿®æ”¹æ ‡è®°                                      â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–°æ–‡ä»¶æ ‘çŠ¶æ€                                         â”‚   â”‚
â”‚  â”‚ â€¢ åˆ é™¤å¤‡ä»½æ–‡ä»¶                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 æ ¸å¿ƒä»£ç å®ç°

```typescript
// TextFileService ä¿å­˜å®ç°
class TextFileService {
  
  async save(resource: URI, options?: ISaveOptions): Promise<boolean> {
    // 1. è·å–æ¨¡å‹
    const model = this.models.get(resource);
    if (!model) {
      return false;
    }
    
    // 2. æ£€æŸ¥æ˜¯å¦è„
    if (!model.isDirty()) {
      return true;
    }
    
    // 3. è§¦å‘ä¿å­˜å‰äº‹ä»¶ï¼ˆå…è®¸æ‰©å±•ä¿®æ”¹å†…å®¹ï¼‰
    const saveEvent = { model, reason: SaveReason.EXPLICIT };
    await this._onWillSave.fire(saveEvent);
    
    // 4. åˆ›å»ºå¤‡ä»½
    const backup = await this.backupFileService.backup(resource, model);
    
    try {
      // 5. å†™å…¥æ–‡ä»¶
      await this.fileService.writeFile(resource, model.createSnapshot(), {
        etag: model.getETag(),
        encoding: model.getEncoding()
      });
      
      // 6. æ›´æ–°æ¨¡å‹çŠ¶æ€
      model.setDirty(false);
      
      // 7. è§¦å‘ä¿å­˜å®Œæˆäº‹ä»¶
      this._onDidSave.fire({ resource, model });
      
      // 8. æ¸…ç†å¤‡ä»½
      await this.backupFileService.discardBackup(resource);
      
      return true;
    } catch (error) {
      // ä¿å­˜å¤±è´¥ï¼Œæ¢å¤å¤‡ä»½
      await this.backupFileService.restoreBackup(resource);
      throw error;
    }
  }
}
```

---

## 8. æ–‡ä»¶å…³é—­æµç¨‹è¯¦è§£

### 8.1 å…³é—­æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     File Close Flow                              â”‚
â”‚                                                                  â”‚
â”‚  ç”¨æˆ·è§¦å‘å…³é—­ (Ctrl+W / Tabå…³é—­æŒ‰é’® / å…³é—­çª—å£)                   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. EditorGroup.closeEditor(editor)                       â”‚   â”‚
â”‚  â”‚    æ£€æŸ¥ç¼–è¾‘å™¨çŠ¶æ€                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. æ£€æŸ¥è„çŠ¶æ€                                             â”‚   â”‚
â”‚  â”‚ if (editor.isDirty())                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚                     â”‚                     â”‚               â”‚
â”‚     â–¼                     â–¼                     â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ å·²ä¿å­˜   â”‚      â”‚ æœªä¿å­˜       â”‚      â”‚ ä¿å­˜ä¸­   â”‚          â”‚
â”‚  â”‚ å¹²å‡€çŠ¶æ€ â”‚      â”‚ æ˜¾ç¤ºå¯¹è¯æ¡†   â”‚      â”‚ ç­‰å¾…     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚     â”‚                     â”‚                     â”‚               â”‚
â”‚     â”‚                     â–¼                     â”‚               â”‚
â”‚     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚               â”‚
â”‚     â”‚              â”‚ å¯¹è¯æ¡†é€‰é¡¹   â”‚            â”‚               â”‚
â”‚     â”‚              â”‚ â€¢ ä¿å­˜       â”‚            â”‚               â”‚
â”‚     â”‚              â”‚ â€¢ ä¸ä¿å­˜     â”‚            â”‚               â”‚
â”‚     â”‚              â”‚ â€¢ å–æ¶ˆ       â”‚            â”‚               â”‚
â”‚     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚               â”‚
â”‚     â”‚                     â”‚                     â”‚               â”‚
â”‚     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚               â”‚
â”‚     â”‚         â”‚           â”‚           â”‚        â”‚               â”‚
â”‚     â”‚         â–¼           â–¼           â–¼        â”‚               â”‚
â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚               â”‚
â”‚     â”‚    â”‚ä¿å­˜    â”‚ â”‚ä¸ä¿å­˜  â”‚ â”‚å–æ¶ˆ    â”‚     â”‚               â”‚
â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚               â”‚
â”‚     â”‚         â”‚           â”‚                    â”‚               â”‚
â”‚     â”‚         â”‚           â–¼                    â”‚               â”‚
â”‚     â”‚         â”‚    ä¸¢å¼ƒä¿®æ”¹                    â”‚               â”‚
â”‚     â”‚         â”‚           â”‚                    â”‚               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. æ¸…ç†ç¼–è¾‘å™¨çŠ¶æ€                                         â”‚   â”‚
â”‚  â”‚ â€¢ é”€æ¯ EditorPane                                        â”‚   â”‚
â”‚  â”‚ â€¢ ä»ç»„ä¸­ç§»é™¤                                             â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–° Tab æ                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. TextModel æ¸…ç†                                         â”‚   â”‚
â”‚  â”‚ â€¢ å‡å°‘å¼•ç”¨è®¡æ•°                                           â”‚   â”‚
â”‚  â”‚ â€¢ å¼•ç”¨ä¸º0æ—¶é”€æ¯æ¨¡å‹                                      â”‚   â”‚
â”‚  â”‚ â€¢ æ¸…ç†ç¼“å­˜                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â”‚                                                            â”‚
â”‚     â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5. è§¦å‘äº‹ä»¶                                               â”‚   â”‚
â”‚  â”‚ â€¢ onDidCloseEditor                                       â”‚   â”‚
â”‚  â”‚ â€¢ æ›´æ–°æ´»åŠ¨ç¼–è¾‘å™¨                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ ¸å¿ƒä»£ç å®ç°

```typescript
// EditorGroup å…³é—­ç¼–è¾‘å™¨
class EditorGroup {
  
  async closeEditor(editor: IEditorInput): Promise<boolean> {
    // 1. æ£€æŸ¥è„çŠ¶æ€
    if (editor.isDirty()) {
      // 2. æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
      const result = await this.confirmClose([editor]);
      
      switch (result) {
        case ConfirmResult.SAVE:
          // ä¿å­˜åå…³é—­
          await this.textFileService.save(editor.resource);
          break;
        case ConfirmResult.DONT_SAVE:
          // ä¸ä¿å­˜ï¼Œæ¢å¤å†…å®¹
          await this.textFileService.revert(editor.resource);
          break;
        case ConfirmResult.CANCEL:
          // å–æ¶ˆå…³é—­
          return false;
      }
    }
    
    // 3. ä»ç¼–è¾‘å™¨ç»„ç§»é™¤
    const index = this.editors.indexOf(editor);
    if (index >= 0) {
      this.editors.splice(index, 1);
    }
    
    // 4. é”€æ¯ç¼–è¾‘å™¨
    editor.dispose();
    
    // 5. è§¦å‘å…³é—­äº‹ä»¶
    this._onDidCloseEditor.fire({
      editor,
      groupId: this.id,
      context: EditorCloseContext.CLOSE
    });
    
    // 6. æ¿€æ´»ä¸‹ä¸€ä¸ªç¼–è¾‘å™¨
    if (this.editors.length > 0) {
      this.activateEditor(this.editors[Math.max(0, index - 1)]);
    }
    
    return true;
  }
  
  // ç¡®è®¤å…³é—­å¯¹è¯æ¡†
  private async confirmClose(editors: IEditorInput[]): Promise<ConfirmResult> {
    const messages = editors.map(e => e.getName());
    const result = await this.dialogService.show(
      Severity.Warning,
      `Do you want to save changes to ${messages.join(', ')}?`,
      ['Save', "Don't Save", 'Cancel']
    );
    
    return result.response;
  }
}
```

---

## 9. å…³é”®æ¥å£å®šä¹‰

### 9.1 ITextModelï¼ˆæ–‡æœ¬æ¨¡å‹ï¼‰

```typescript
/**
 * æ–‡æœ¬æ¨¡å‹æ¥å£ - Monaco Editor æ ¸å¿ƒ
 * ç®¡ç†æ–‡æœ¬å†…å®¹ã€è¡Œå·ã€è¯­è¨€æ¨¡å¼ç­‰
 */
interface ITextModel {
  // å”¯ä¸€æ ‡è¯†
  readonly id: string;
  readonly uri: URI;
  
  // å†…å®¹å±æ€§
  readonly getValueLength(): number;           // æ–‡æœ¬é•¿åº¦
  readonly getLineCount(): number;             // è¡Œæ•°
  getValue(options?: IGetValueOptions): string; // è·å–å†…å®¹
  getValueInRange(range: IRange): string;      // è·å–èŒƒå›´å†…å®¹
  
  // ç‰ˆæœ¬æ§åˆ¶
  readonly getVersionId(): number;             // ç‰ˆæœ¬ID
  
  // ç¼–è¾‘æ“ä½œ
  applyEdits(operations: IIdentifiedSingleEditOperation[]): IValidEditOperation[];
  pushEditOperations(beforeCursorState: Selection[], 
                     editOperations: IIdentifiedSingleEditOperation[],
                     cursorStateComputer: ICursorStateComputer): Selection[];
  
  // äº‹ä»¶
  readonly onDidChangeContent: Event<IModelContentChangedEvent>;
  readonly onDidChangeLanguage: Event<IModelLanguageChangedEvent>;
  readonly onWillDispose: Event<void>;
  
  // å¿«ç…§
  createSnapshot(): ITextSnapshot;
  
  // é”€æ¯
  dispose(): void;
}
```

### 9.2 ITextFileEditorModelï¼ˆæ–‡æœ¬æ–‡ä»¶ç¼–è¾‘å™¨æ¨¡å‹ï¼‰

```typescript
/**
 * æ–‡æœ¬æ–‡ä»¶ç¼–è¾‘å™¨æ¨¡å‹
 * ç®¡ç†æ–‡ä»¶çš„å†…å­˜è¡¨ç¤ºã€è„çŠ¶æ€ã€ç‰ˆæœ¬ç­‰
 */
interface ITextFileEditorModel extends ITextFileModelBase {
  // èµ„æºæ ‡è¯†
  readonly resource: URI;
  
  // æ–‡æœ¬æ¨¡å‹
  readonly textModel: ITextModel | undefined;
  
  // çŠ¶æ€
  readonly isDirty: boolean;
  readonly isResolved: boolean;
  readonly isOrphaned: boolean;
  
  // å†…å®¹
  readonly encoding: string;
  readonly preferredEncoding: string;
  
  // ç‰ˆæœ¬
  readonly versionId: number;
  readonly savedVersionId: number;
  
  // æ–¹æ³•
  resolve(options?: IResolveOptions): Promise<void>;
  save(options?: ISaveOptions): Promise<boolean>;
  revert(options?: IRevertOptions): Promise<boolean>;
  
  // å¿«ç…§
  createSnapshot(): ITextSnapshot;
  
  // äº‹ä»¶
  readonly onDidChangeContent: Event<void>;
  readonly onDidChangeDirty: Event<void>;
  readonly onDidSave: Event<void>;
  readonly onDidChangeEncoding: Event<void>;
  readonly onDidChangeOrphaned: Event<void>;
}
```

### 9.3 IEditorInputï¼ˆç¼–è¾‘å™¨è¾“å…¥ï¼‰

```typescript
/**
 * ç¼–è¾‘å™¨è¾“å…¥æŠ½è±¡
 * è¡¨ç¤ºä¸€ä¸ªå¯è¢«ç¼–è¾‘å™¨æ‰“å¼€çš„èµ„æº
 */
interface IEditorInput {
  // ç±»å‹æ ‡è¯†
  readonly typeId: string;
  
  // æ˜¾ç¤ºä¿¡æ¯
  getName(): string;
  getDescription(): string;
  getTitle(): string;
  
  // èµ„æº
  readonly resource: URI | undefined;
  
  // èƒ½åŠ›
  readonly capabilities: EditorInputCapabilities;
  
  // çŠ¶æ€
  isDirty(): boolean;
  isReadonly(): boolean;
  
  // éªŒè¯
  matches(other: IEditorInput): boolean;
  
  // ä¿å­˜ç›¸å…³
  save(groupId: GroupIdentifier, options?: ISaveOptions): Promise<IEditorInput | undefined>;
  revert(groupId: GroupIdentifier, options?: IRevertOptions): Promise<void>;
  
  // å¤åˆ¶
  copy(): IEditorInput;
  
  // ç”Ÿå‘½å‘¨æœŸ
  dispose(): void;
}

// ç¼–è¾‘å™¨èƒ½åŠ›æ ‡å¿—
enum EditorInputCapabilities {
  None = 0,
  Readable = 1 << 1,
  Writable = 1 << 2,
  CanSave = 1 << 3,
  CanRevert = 1 << 4,
  Untitled = 1 << 5,
  RequiresTrust = 1 << 6,
}
```

### 9.4 IEditorGroupï¼ˆç¼–è¾‘å™¨ç»„ï¼‰

```typescript
/**
 * ç¼–è¾‘å™¨ç»„
 * ç®¡ç†ä¸€ç»„æ ‡ç­¾é¡µå’Œç¼–è¾‘å™¨å®ä¾‹
 */
interface IEditorGroup {
  // æ ‡è¯†
  readonly id: GroupIdentifier;
  readonly index: number;
  
  // ç¼–è¾‘å™¨åˆ—è¡¨
  readonly editors: IEditorInput[];
  readonly count: number;
  
  // æ´»åŠ¨ç¼–è¾‘å™¨
  readonly activeEditor: IEditorInput | undefined;
  readonly previewEditor: IEditorInput | undefined;
  
  // æ–¹å‘
  readonly orientation: GroupOrientation;
  
  // çª—å£ç›¸å…³
  readonly windowId: number;
  
  // æ–¹æ³•
  openEditor(editor: IEditorInput, options?: IEditorOptions): Promise<IEditorPane | undefined>;
  closeEditor(editor: IEditorInput, options?: ICloseEditorOptions): Promise<boolean>;
  closeEditors(editors: IEditorInput[], options?: ICloseEditorOptions): Promise<boolean>;
  closeAllEditors(): Promise<boolean>;
  
  // æ¿€æ´»
  activateEditor(editor: IEditorInput): void;
  
  // ç„¦ç‚¹
  focus(): void;
  
  // æ’åº
  moveEditor(editor: IEditorInput, toIndex: number): void;
  
  // äº‹ä»¶
  readonly onDidOpenEditor: Event<IEditorInput>;
  readonly onDidCloseEditor: Event<IEditorCloseEvent>;
  readonly onDidChangeActiveEditor: Event<IEditorInput>;
  readonly onDidDispose: Event<void>;
}
```

### 9.5 IFileStatï¼ˆæ–‡ä»¶çŠ¶æ€ï¼‰

```typescript
/**
 * æ–‡ä»¶ç³»ç»ŸçŠ¶æ€
 * è¡¨ç¤ºæ–‡ä»¶æˆ–ç›®å½•çš„å…ƒä¿¡æ¯
 */
interface IFileStat {
  // èµ„æºæ ‡è¯†
  readonly resource: URI;
  
  // åç§°
  readonly name: string;
  
  // ç±»å‹
  readonly isFile: boolean;
  readonly isDirectory: boolean;
  readonly isSymbolicLink: boolean;
  
  // æ—¶é—´
  readonly mtime: number;      // ä¿®æ”¹æ—¶é—´
  readonly ctime: number;      // åˆ›å»ºæ—¶é—´
  
  // å¤§å°
  readonly size: number;
  
  // å­é¡¹ï¼ˆç›®å½•ï¼‰
  readonly children?: IFileStat[];
  
  // æƒé™
  readonly permissions?: FilePermission;
}

// æ–‡ä»¶æƒé™
enum FilePermission {
  Readable = 1,
  Writable = 2,
}
```

---

## 10. æ•°æ®æµç¤ºæ„å›¾

### 10.1 æ–‡ä»¶æ‰“å¼€æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    openEditor()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    resolve()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚EditorService â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚TextFileServiceâ”‚
â”‚ Explorerâ”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  View   â”‚                           â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                                â”‚
                                      â–¼                                â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚EditorGroup   â”‚                â”‚ FileService  â”‚
                              â”‚ (åˆ›å»ºInput)  â”‚                â”‚(è¯»å–æ–‡ä»¶å†…å®¹)â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                                â”‚
                                      â”‚                                â”‚
                                      â–¼                                â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚FileEditorInputâ”‚               â”‚IStreamContentâ”‚
                              â”‚(ç¼–è¾‘å™¨è¾“å…¥)   â”‚               â”‚(æ–‡ä»¶å†…å®¹)    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                                â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚TextModelServiceâ”‚
                                              â”‚(åˆ›å»ºTextModel)â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  ITextModel  â”‚
                                              â”‚ (æ–‡æœ¬æ¨¡å‹)   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚CodeEditorWidgetâ”‚
                                              â”‚ (ç¼–è¾‘å™¨ç»„ä»¶) â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç¼–è¾‘åˆ°ä¿å­˜æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    onDidChangeContent    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Monaco Editorâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  TextModel   â”‚
â”‚   (è¾“å…¥)    â”‚                          â”‚  (å˜æ›´äº‹ä»¶)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚TextFileModel â”‚
                                         â”‚(æ£€æµ‹è„çŠ¶æ€)  â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                                           â”‚
                          â–¼                                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ onDidChange- â”‚                           â”‚ Tab æ æ›´æ–°   â”‚
                   â”‚ Dirty äº‹ä»¶   â”‚                           â”‚ (æ˜¾ç¤ºâ—æ ‡è®°)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ save()
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    writeFile()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚TextFileServiceâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ FileService  â”‚
                   â”‚              â”‚                   â”‚              â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                                   â”‚
                          â”‚                                   â–¼
                          â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                           â”‚ Main Process â”‚
                          â”‚                           â”‚  (å†™å…¥ç£ç›˜)  â”‚
                          â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                                   â”‚
                          â–¼                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
                   â”‚ onDidSave    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚   äº‹ä»¶       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ UI æ›´æ–°      â”‚
                   â”‚(ç§»é™¤â—æ ‡è®°)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 æ–‡ä»¶ç³»ç»Ÿç›‘è§†æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶    â”‚    FileWatcher    â”‚   Main Process   â”‚
â”‚ (åˆ›å»º/ä¿®æ”¹/åˆ é™¤) â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ IPC Broadcast
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Renderer Process â”‚
                                        â”‚                  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                      â”‚                      â”‚
                        â–¼                      â–¼                      â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ FileService  â”‚      â”‚TextFileServiceâ”‚     â”‚  Explorer    â”‚
                 â”‚(æ›´æ–°ç¼“å­˜)    â”‚      â”‚(æ£€æŸ¥å†²çª)    â”‚      â”‚ (åˆ·æ–°æ–‡ä»¶æ ‘) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                      â”‚
                        â”‚                      â”‚
                        â–¼                      â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ onDidFiles-  â”‚      â”‚ å†²çªå¯¹è¯æ¡†   â”‚
                 â”‚ Changeäº‹ä»¶   â”‚      â”‚(å¦‚æœéœ€è¦)    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½•ï¼šæ ¸å¿ƒæ¨¡å—æ¸…å•

| æ¨¡å—åç§° | è·¯å¾„ | èŒè´£ |
|---------|------|------|
| FileService | `vs/platform/files/common/fileService.ts` | æ–‡ä»¶ç³»ç»Ÿæ“ä½œå°è£… |
| TextFileService | `vs/workbench/services/textfile/common/textFileService.ts` | æ–‡æœ¬æ–‡ä»¶ç®¡ç† |
| EditorService | `vs/workbench/services/editor/common/editorService.ts` | ç¼–è¾‘å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† |
| EditorGroupsService | `vs/workbench/services/editor/common/editorGroupsService.ts` | ç¼–è¾‘å™¨ç»„ç®¡ç† |
| TextModelService | `vs/editor/common/services/modelService.ts` | æ–‡æœ¬æ¨¡å‹ç®¡ç† |
| ExplorerService | `vs/workbench/contrib/files/browser/explorerService.ts` | æ–‡ä»¶æ ‘ç®¡ç† |
| WorkspaceContextService | `vs/platform/workspace/common/workspace.ts` | å·¥ä½œåŒºä¸Šä¸‹æ–‡ |
| BackupFileService | `vs/workbench/services/backup/common/backupFileService.ts` | æ–‡ä»¶å¤‡ä»½ç®¡ç† |
| FileWatcher | `vs/platform/files/node/watcher.ts` | æ–‡ä»¶ç³»ç»Ÿç›‘è§† |

---

> æœ¬æ–‡æ¡£åŸºäº VSCode æºç æ¶æ„åˆ†æï¼Œæè¿°äº†æ–‡ä»¶æ‰“å¼€ã€ç¼–è¾‘ã€ä¿å­˜ã€å…³é—­çš„å®Œæ•´æµç¨‹ã€‚å¦‚éœ€è¿›ä¸€æ­¥äº†è§£å…·ä½“å®ç°ç»†èŠ‚ï¼Œè¯·å‚è€ƒ [VSCode GitHub ä»“åº“](https://github.com/microsoft/vscode)ã€‚
