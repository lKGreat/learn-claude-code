<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:MiniClaudeCode.Avalonia.ViewModels"
        xmlns:views="using:MiniClaudeCode.Avalonia.Views"
        x:Class="MiniClaudeCode.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="1400" Height="900"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen">

    <Window.KeyBindings>
        <!-- File -->
        <KeyBinding Gesture="Ctrl+N" Command="{Binding NewConversationCommand}" />
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenWorkspaceCommand}" />
        <KeyBinding Gesture="Ctrl+S" Command="{Binding Editor.SaveFileCommand}" />
        
        <!-- View -->
        <KeyBinding Gesture="Ctrl+Shift+E" Command="{Binding ActivityBar.SelectItemCommand}" CommandParameter="{Binding ActivityBar.Items[0]}" />
        <KeyBinding Gesture="Ctrl+Shift+F" Command="{Binding ActivityBar.SelectItemCommand}" CommandParameter="{Binding ActivityBar.Items[1]}" />
        <KeyBinding Gesture="Ctrl+Shift+G" Command="{Binding ActivityBar.SelectItemCommand}" CommandParameter="{Binding ActivityBar.Items[2]}" />
        <KeyBinding Gesture="Ctrl+Shift+X" Command="{Binding ActivityBar.SelectItemCommand}" CommandParameter="{Binding ActivityBar.Items[3]}" />
        <KeyBinding Gesture="Ctrl+Shift+C" Command="{Binding ActivityBar.SelectItemCommand}" CommandParameter="{Binding ActivityBar.Items[4]}" />
        <KeyBinding Gesture="Ctrl+OemTilde" Command="{Binding BottomPanel.ToggleVisibilityCommand}" />
        
        <!-- Command Palette -->
        <KeyBinding Gesture="Ctrl+Shift+P" Command="{Binding CommandPalette.ShowCommand}" />
        <KeyBinding Gesture="Ctrl+P" Command="{Binding CommandPalette.ShowQuickOpenCommand}" />
        
        <!-- Other -->
        <KeyBinding Gesture="Escape" Command="{Binding CancelOperationCommand}" />
    </Window.KeyBindings>

    <!-- Use Panel as root to allow overlay dialogs -->
    <Panel>
        <!-- Main VS Code-style 6-region layout -->
        <DockPanel>
            <!-- Top: Menu Bar -->
            <Menu DockPanel.Dock="Top" Background="#181825">
                <MenuItem Header="_File">
                    <MenuItem Header="_Open Folder..." InputGesture="Ctrl+O" Command="{Binding OpenWorkspaceCommand}" />
                    <MenuItem Header="Recent _Workspaces" ItemsSource="{Binding RecentWorkspaceMenuItems}">
                        <MenuItem.ItemContainerTheme>
                            <ControlTheme TargetType="MenuItem" x:DataType="vm:RecentWorkspaceMenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                                <Setter Property="Header" Value="{Binding DisplayName}" />
                                <Setter Property="Command" Value="{Binding OpenCommand}" />
                            </ControlTheme>
                        </MenuItem.ItemContainerTheme>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="_New Conversation" InputGesture="Ctrl+N" Command="{Binding NewConversationCommand}" />
                    <MenuItem Header="_Save File" InputGesture="Ctrl+S" Command="{Binding Editor.SaveFileCommand}" />
                    <Separator />
                    <MenuItem Header="E_xit" Command="{Binding ExitAppCommand}" />
                </MenuItem>
                <MenuItem Header="_Edit">
                    <MenuItem Header="_Find" InputGesture="Ctrl+F" />
                    <MenuItem Header="_Replace" InputGesture="Ctrl+H" />
                </MenuItem>
                <MenuItem Header="_View">
                    <MenuItem Header="_Command Palette..." InputGesture="Ctrl+Shift+P" Command="{Binding CommandPalette.ShowCommand}" />
                    <MenuItem Header="_Open File..." InputGesture="Ctrl+P" Command="{Binding CommandPalette.ShowQuickOpenCommand}" />
                    <Separator />
                    <MenuItem Header="_Explorer" InputGesture="Ctrl+Shift+E" />
                    <MenuItem Header="_Search" InputGesture="Ctrl+Shift+F" />
                    <MenuItem Header="_Source Control" InputGesture="Ctrl+Shift+G" />
                    <MenuItem Header="E_xtensions" InputGesture="Ctrl+Shift+X" />
                    <Separator />
                    <MenuItem Header="_Terminal" InputGesture="Ctrl+`" Command="{Binding BottomPanel.ToggleVisibilityCommand}" />
                    <MenuItem Header="_Plan Mode" Command="{Binding TogglePlanModeCommand}" />
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem Header="_About" Click="OnAboutClick" />
                </MenuItem>
            </Menu>

            <!-- Bottom: Status Bar -->
            <views:StatusBarView DockPanel.Dock="Bottom"
                                  DataContext="{Binding StatusBar}" />

            <!-- Main content area with 3-column layout: ActivityBar | Sidebar | EditorArea+BottomPanel -->
            <Grid ColumnDefinitions="Auto,Auto,*">
                
                <!-- Column 0: Activity Bar (48px, left-most icon strip) -->
                <views:ActivityBarView Grid.Column="0"
                                        DataContext="{Binding ActivityBar}" />

                <!-- Column 1: Sidebar (collapsible, 250px) -->
                <Border Grid.Column="1"
                        Width="{Binding Sidebar.Width}"
                        IsVisible="{Binding Sidebar.IsVisible}">
                    <Grid ColumnDefinitions="*,5">
                        <views:SidebarView Grid.Column="0" />
                        
                        <GridSplitter Grid.Column="1"
                                      ResizeDirection="Columns"
                                      Background="#313244" />
                    </Grid>
                </Border>

                <!-- Column 2: Editor Area + Bottom Panel -->
                <DockPanel Grid.Column="2">
                    <!-- Bottom Panel (collapsible) -->
                    <Border DockPanel.Dock="Bottom"
                            Height="{Binding BottomPanel.Height}"
                            IsVisible="{Binding BottomPanel.IsVisible}">
                        <Grid RowDefinitions="5,*">
                            <GridSplitter Grid.Row="0"
                                          ResizeDirection="Rows"
                                          Background="#313244"
                                          HorizontalAlignment="Stretch" />
                            
                            <views:BottomPanelView Grid.Row="1" />
                        </Grid>
                    </Border>

                    <!-- Center: Editor Area -->
                    <views:EditorView DataContext="{Binding Editor}" />
                </DockPanel>
            </Grid>
        </DockPanel>

        <!-- Overlay: Command Palette -->
        <views:CommandPaletteView DataContext="{Binding CommandPalette}" />

        <!-- Overlay: Notification Toasts -->
        <views:NotificationToastView DataContext="{Binding Notification}" />

        <!-- Overlay: Setup Wizard Dialog -->
        <views:SetupWizardDialog DataContext="{Binding SetupWizard}"
                                  IsVisible="{Binding IsVisible}"
                                  IsHitTestVisible="{Binding IsVisible}" />

        <!-- Overlay: Question Dialog -->
        <views:QuestionDialog DataContext="{Binding QuestionDialog}"
                               IsVisible="{Binding IsVisible}"
                               IsHitTestVisible="{Binding IsVisible}" />
    </Panel>
</Window>
