<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MiniClaudeCode.Avalonia.ViewModels"
             x:Class="MiniClaudeCode.Avalonia.Views.ExtensionsPanelView"
             x:DataType="vm:ExtensionsViewModel">

    <Border Classes="sidebarSectionRoot"
            Background="{DynamicResource ThemeSideBarBackground}">
        <DockPanel>
            <!-- Header -->
            <Border DockPanel.Dock="Top"
                    Classes="sidebarSectionHeader">
                <DockPanel>
                    <TextBlock Text="Extensions"
                               Classes="sidebarSectionTitle" />
                    <Button Classes="panelIconAction"
                            DockPanel.Dock="Right"
                            Content="\u21BB"
                            Command="{Binding DiscoverExtensionsCommand}"
                            ToolTip.Tip="Refresh Extensions"
                            FontSize="12" Padding="4,2"
                            HorizontalAlignment="Right" />
                </DockPanel>
            </Border>

            <!-- Search -->
            <Border DockPanel.Dock="Top"
                    Classes="sidebarSectionBody"
                    Padding="8,4">
                <TextBox Text="{Binding SearchQuery}"
                         Watermark="Search Extensions..."
                         FontSize="12"
                         Background="{DynamicResource ThemeInputBackground}"
                         BorderBrush="{DynamicResource ThemeInputBorder}" />
            </Border>

            <!-- Extension list -->
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="2" Margin="4">
                    <!-- Installed section -->
                    <Expander Header="{Binding InstalledHeader}"
                              IsExpanded="True"
                              Padding="0">
                        <ItemsControl ItemsSource="{Binding FilteredExtensions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:ExtensionListItem">
                                    <Border Padding="8,6" Margin="0,1"
                                            Background="{DynamicResource ThemeInputBackground}" CornerRadius="4">
                                        <DockPanel>
                                            <!-- Extension icon placeholder -->
                                            <Border DockPanel.Dock="Left"
                                                    Width="32" Height="32"
                                                    Background="{DynamicResource ThemeButtonBackground}"
                                                    CornerRadius="4"
                                                    Margin="0,0,8,0">
                                                <TextBlock Text="\U0001F9E9"
                                                           FontSize="16"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                            </Border>

                                            <!-- Activate/Deactivate button -->
                                            <StackPanel DockPanel.Dock="Right"
                                                        VerticalAlignment="Center"
                                                        Margin="4,0,0,0">
                                                <Button Content="{Binding StateDisplay}"
                                                        FontSize="9" Padding="6,2"
                                                    Background="{DynamicResource ThemeButtonBackground}"
                                                    Foreground="{DynamicResource ThemeGreen}" />
                                            </StackPanel>

                                            <!-- Extension details -->
                                            <StackPanel Spacing="1">
                                                <TextBlock Text="{Binding Name}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{DynamicResource ThemeText}" />
                                                <TextBlock Text="{Binding Description}"
                                                           FontSize="10"
                                                           Foreground="{DynamicResource ThemeMutedForeground}"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxLines="1" />
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <TextBlock Text="{Binding Publisher}"
                                                               FontSize="9"
                                                               Foreground="{DynamicResource ThemeMutedForeground}" />
                                                    <TextBlock Text="{Binding Version}"
                                                               FontSize="9"
                                                               Foreground="{DynamicResource ThemeMutedForeground}"
                                                               Opacity="0.5" />
                                                </StackPanel>
                                            </StackPanel>
                                        </DockPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Expander>

                    <!-- Empty state -->
                    <StackPanel VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Spacing="8"
                                Margin="16"
                                IsVisible="{Binding !FilteredExtensions.Count}">
                        <TextBlock Text="\U0001F9E9"
                                   FontSize="32"
                                   HorizontalAlignment="Center"
                                   Opacity="0.3" />
                        <TextBlock Text="No extensions installed"
                                   FontSize="13"
                                   Foreground="{DynamicResource ThemeText}"
                                   HorizontalAlignment="Center"
                                   Opacity="0.5" />
                        <TextBlock Text="Place extensions in the extensions directory to get started."
                                   FontSize="11"
                                   Foreground="{DynamicResource ThemeMutedForeground}"
                                   HorizontalAlignment="Center"
                                   TextWrapping="Wrap"
                                   TextAlignment="Center"
                                   Opacity="0.4" />
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </DockPanel>
    </Border>
</UserControl>
