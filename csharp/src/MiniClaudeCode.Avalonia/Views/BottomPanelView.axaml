<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MiniClaudeCode.Avalonia.ViewModels"
             xmlns:views="using:MiniClaudeCode.Avalonia.Views"
             xmlns:conv="using:MiniClaudeCode.Avalonia.Converters"
             x:Class="MiniClaudeCode.Avalonia.Views.BottomPanelView"
             x:DataType="vm:MainWindowViewModel">

    <Border Background="#181825"
            BorderBrush="#313244"
            BorderThickness="0,1,0,0">
        <DockPanel>
            <!-- Tab strip header -->
            <Border DockPanel.Dock="Top"
                    Background="#1E1E2E"
                    Padding="0">
                <DockPanel>
                    <!-- Panel tabs -->
                    <StackPanel Orientation="Horizontal" Spacing="0">
                        <!-- Terminal tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="terminal"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsTerminalTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Terminal"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsTerminalTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>

                        <!-- Problems tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="problems"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsProblemsTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Problems"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsProblemsTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>

                        <!-- Output tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="output"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsOutputTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Output"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsOutputTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>

                        <!-- Debug Console tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="debugconsole"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="False"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Debug Console"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="0.6" />
                            </DockPanel>
                        </Button>

                        <!-- Tool Calls tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="toolcalls"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsToolCallsTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Tool Calls"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsToolCallsTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>

                        <!-- Agents tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="agents"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsAgentsTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Agents"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsAgentsTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>

                        <!-- Todos tab -->
                        <Button Command="{Binding BottomPanel.SwitchTabCommand}"
                                CommandParameter="todos"
                                FontSize="11"
                                Padding="10,5,10,3"
                                Background="Transparent"
                                BorderThickness="0"
                                Cursor="Hand">
                            <DockPanel>
                                <Border DockPanel.Dock="Bottom"
                                        Classes="tabActiveIndicator"
                                        IsVisible="{Binding BottomPanel.IsTodosTab}"
                                        Margin="0,2,0,0" />
                                <TextBlock Text="Todos"
                                           Foreground="{DynamicResource ThemeText}"
                                           Opacity="{Binding BottomPanel.IsTodosTab, Converter={x:Static conv:BoolToOpacityConverter.Instance}}" />
                            </DockPanel>
                        </Button>
                    </StackPanel>

                    <!-- Panel controls (right side) -->
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Spacing="2"
                                Margin="4,0">
                        <Button Content="\u2191"
                                Command="{Binding BottomPanel.ToggleMaximizeCommand}"
                                ToolTip.Tip="Maximize Panel"
                                FontSize="10" Padding="4,2"
                                Background="Transparent" Foreground="#6C7086" />
                        <Button Content="\u2715"
                                Command="{Binding BottomPanel.ClosePanelCommand}"
                                ToolTip.Tip="Close Panel"
                                FontSize="10" Padding="4,2"
                                Background="Transparent" Foreground="#6C7086" />
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Tab content area -->
            <Panel>
                <!-- Terminal -->
                <views:TerminalView DataContext="{Binding Terminal}"
                                     IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsTerminalTab}" />

                <!-- Tool Calls -->
                <views:ToolCallPanelView DataContext="{Binding ToolCallPanel}"
                                          IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsToolCallsTab}" />

                <!-- Agents -->
                <views:AgentPanelView DataContext="{Binding AgentPanel}"
                                       IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsAgentsTab}" />

                <!-- Todos -->
                <views:TodoPanelView DataContext="{Binding TodoPanel}"
                                      IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsTodosTab}" />

                <!-- Problems panel -->
                <Border Background="#181825"
                        IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsProblemsTab}">
                    <DockPanel>
                        <Border DockPanel.Dock="Top" Padding="8,4" Background="#1E1E2E">
                            <DockPanel>
                                <TextBlock Text="{Binding BottomPanel.ProblemsHeader}"
                                           FontSize="11" Foreground="#CDD6F4" />
                                <Button DockPanel.Dock="Right"
                                        Content="Clear"
                                        Command="{Binding BottomPanel.ClearProblemsCommand}"
                                        FontSize="10" Padding="6,2"
                                        Background="Transparent" Foreground="#6C7086"
                                        HorizontalAlignment="Right" />
                            </DockPanel>
                        </Border>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Panel>
                                <ItemsControl ItemsSource="{Binding BottomPanel.Problems}"
                                              IsVisible="{Binding BottomPanel.HasProblems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="vm:ProblemItem">
                                            <Border Padding="8,3" Cursor="Hand">
                                                <DockPanel>
                                                    <TextBlock Text="{Binding SeverityIcon}"
                                                               Foreground="{Binding SeverityColor}"
                                                               FontSize="11" Width="16"
                                                               DockPanel.Dock="Left" />
                                                    <TextBlock Text="{Binding LocationDisplay}"
                                                               FontSize="10" Foreground="#6C7086"
                                                               DockPanel.Dock="Right"
                                                               Margin="8,0,0,0" />
                                                    <StackPanel Spacing="1">
                                                        <TextBlock Text="{Binding Message}"
                                                                   FontSize="11" Foreground="#CDD6F4"
                                                                   TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Text="{Binding File}"
                                                                   FontSize="10" Foreground="#6C7086"
                                                                   Opacity="0.6"
                                                                   TextTrimming="CharacterEllipsis" />
                                                    </StackPanel>
                                                </DockPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="No problems detected."
                                           FontSize="12" Foreground="#6C7086"
                                           Margin="12,8"
                                           IsVisible="{Binding !BottomPanel.HasProblems}" />
                            </Panel>
                        </ScrollViewer>
                    </DockPanel>
                </Border>

                <!-- Output panel -->
                <Border Background="#181825"
                        IsVisible="{Binding $parent[views:BottomPanelView].((vm:MainWindowViewModel)DataContext).BottomPanel.IsOutputTab}">
                    <DockPanel>
                        <Border DockPanel.Dock="Top" Padding="8,4" Background="#1E1E2E">
                            <DockPanel>
                                <ComboBox ItemsSource="{Binding BottomPanel.OutputChannels}"
                                          SelectedItem="{Binding BottomPanel.ActiveOutputChannel}"
                                          FontSize="11" MinWidth="120"
                                          Background="#11111B" />
                                <Button DockPanel.Dock="Right"
                                        Content="Clear"
                                        Command="{Binding BottomPanel.ClearOutputCommand}"
                                        FontSize="10" Padding="6,2"
                                        Background="Transparent" Foreground="#6C7086"
                                        HorizontalAlignment="Right" />
                            </DockPanel>
                        </Border>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding BottomPanel.OutputEntries}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:OutputEntry">
                                        <DockPanel Margin="8,1">
                                            <TextBlock Text="{Binding TimestampDisplay}"
                                                       FontSize="10" Foreground="#6C7086"
                                                       FontFamily="Cascadia Code, Consolas, monospace"
                                                       DockPanel.Dock="Left"
                                                       Width="60" Opacity="0.5" />
                                            <TextBlock Text="{Binding Message}"
                                                       FontSize="11" Foreground="#CDD6F4"
                                                       FontFamily="Cascadia Code, Consolas, monospace"
                                                       TextWrapping="Wrap" />
                                        </DockPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </DockPanel>
                </Border>
            </Panel>
        </DockPanel>
    </Border>
</UserControl>
