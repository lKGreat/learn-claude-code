<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MiniClaudeCode.Avalonia.ViewModels"
             xmlns:conv="using:MiniClaudeCode.Avalonia.Converters"
             x:Class="MiniClaudeCode.Avalonia.Views.SetupWizardDialog"
             x:DataType="vm:SetupWizardViewModel">

    <!-- Full-screen overlay backdrop -->
    <Grid>
        <!-- Semi-transparent backdrop -->
        <Border Background="#80000000" />

        <!-- Dialog card -->
        <Border Background="#1E1E2E"
                CornerRadius="12"
                Padding="32,24"
                Width="460"
                MaxHeight="500"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 8 32 0 #40000000">
            <StackPanel Spacing="16">
                <!-- Header -->
                <DockPanel>
                    <TextBlock Text="Setup Wizard"
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="#CDD6F4" />
                    <TextBlock DockPanel.Dock="Right"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"
                               FontSize="12"
                               Opacity="0.5">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Step {0}/{1}">
                                <Binding Path="CurrentStep" />
                                <Binding Path="TotalSteps" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </DockPanel>

                <Separator />

                <!-- Step 1: Provider Selection -->
                <StackPanel Spacing="12" IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.Step1}}">
                    <TextBlock Text="Select your AI provider:"
                               FontSize="14"
                               Foreground="#CDD6F4" />
                    <ComboBox ItemsSource="{Binding AvailableProviders}"
                              SelectedItem="{Binding SelectedProvider}"
                              HorizontalAlignment="Stretch" />
                </StackPanel>

                <!-- Step 2: API Key -->
                <StackPanel Spacing="12" IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.Step2}}">
                    <TextBlock FontSize="14" Foreground="#CDD6F4">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Enter your {0} API Key:">
                                <Binding Path="SelectedProvider" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                    <TextBox Text="{Binding ApiKey}"
                             PasswordChar="*"
                             Watermark="sk-..." />
                </StackPanel>

                <!-- Step 3: Model Selection -->
                <StackPanel Spacing="12" IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.Step3}}">
                    <TextBlock Text="Select model:"
                               FontSize="14"
                               Foreground="#CDD6F4" />
                    <ComboBox ItemsSource="{Binding AvailableModels}"
                              SelectedItem="{Binding ModelId}"
                              HorizontalAlignment="Stretch" />

                    <!-- Summary -->
                    <Border Background="#11111B" CornerRadius="6" Padding="12,8" Margin="0,8,0,0">
                        <StackPanel Spacing="4">
                            <TextBlock FontSize="12" Opacity="0.6" Text="Configuration Summary:" />
                            <TextBlock FontSize="13" Foreground="#CDD6F4">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="Provider: {0}">
                                        <Binding Path="SelectedProvider" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                            <TextBlock FontSize="13" Foreground="#CDD6F4" Text="API Key: ********" />
                            <TextBlock FontSize="13" Foreground="#CDD6F4">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="Model: {0}">
                                        <Binding Path="ModelId" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Error message -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#F87171"
                           FontSize="12"
                           IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Buttons -->
                <DockPanel Margin="0,8,0,0">
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            HorizontalAlignment="Left" 
                            Padding="20,8" />
                    <StackPanel DockPanel.Dock="Right"
                                Orientation="Horizontal"
                                Spacing="8"
                                HorizontalAlignment="Right">
                        <Button Content="Back"
                                Command="{Binding BackCommand}"
                                IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.NotStep1}}"
                                Padding="20,8" />
                        <Button Content="Next"
                                Command="{Binding NextCommand}"
                                IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.NotStep3}}"
                                Padding="20,8" />
                        <Button Content="Confirm"
                                Command="{Binding ConfirmCommand}"
                                IsVisible="{Binding CurrentStep, Converter={x:Static conv:StepConverter.Step3}}"
                                Padding="20,8" />
                    </StackPanel>
                </DockPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
