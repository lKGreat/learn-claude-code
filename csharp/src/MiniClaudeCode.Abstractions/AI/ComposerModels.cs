namespace MiniClaudeCode.Abstractions.AI;

/// <summary>
/// A multi-file edit plan generated by the composer AI.
/// Contains a sequence of steps to execute across multiple files.
/// </summary>
public record ComposerPlan
{
    /// <summary>Human-readable description of what this plan accomplishes.</summary>
    public required string Description { get; init; }

    /// <summary>Ordered list of steps to execute.</summary>
    public required IReadOnlyList<ComposerStep> Steps { get; init; }

    /// <summary>Estimated time to complete in milliseconds.</summary>
    public int EstimatedDurationMs { get; init; }

    /// <summary>True if this plan requires user approval before execution.</summary>
    public bool RequiresApproval { get; init; }

    /// <summary>Additional metadata about the plan.</summary>
    public IReadOnlyDictionary<string, string>? Metadata { get; init; }
}

/// <summary>
/// A single step in a composer plan, representing an operation on one file.
/// </summary>
public record ComposerStep
{
    /// <summary>Absolute path to the file being modified.</summary>
    public required string FilePath { get; init; }

    /// <summary>Type of operation to perform.</summary>
    public required ComposerAction Action { get; init; }

    /// <summary>Human-readable description of this step.</summary>
    public required string Description { get; init; }

    /// <summary>The original code before the edit (null for create action).</summary>
    public string? BeforeCode { get; init; }

    /// <summary>The code after the edit (null for delete action).</summary>
    public string? AfterCode { get; init; }

    /// <summary>Zero-based start line for the edit (null for create/delete).</summary>
    public int? StartLine { get; init; }

    /// <summary>Zero-based end line for the edit (null for create/delete).</summary>
    public int? EndLine { get; init; }

    /// <summary>Unified diff representation of the changes.</summary>
    public string? Diff { get; init; }
}

/// <summary>
/// Type of file operation in a composer step.
/// </summary>
public enum ComposerAction
{
    /// <summary>Create a new file.</summary>
    Create,

    /// <summary>Modify an existing file.</summary>
    Modify,

    /// <summary>Delete an existing file.</summary>
    Delete
}

/// <summary>
/// Result of executing a composer plan.
/// Contains success/failure status for each step.
/// </summary>
public record ComposerResult
{
    /// <summary>True if all steps executed successfully.</summary>
    public bool Success { get; init; }

    /// <summary>Results for each step in the plan.</summary>
    public required IReadOnlyList<ComposerStepResult> StepResults { get; init; }

    /// <summary>Total execution time in milliseconds.</summary>
    public long ExecutionTimeMs { get; init; }

    /// <summary>Overall error message if the plan failed.</summary>
    public string? ErrorMessage { get; init; }
}

/// <summary>
/// Result of executing a single composer step.
/// </summary>
public record ComposerStepResult
{
    /// <summary>The step that was executed.</summary>
    public required ComposerStep Step { get; init; }

    /// <summary>True if the step executed successfully.</summary>
    public bool Success { get; init; }

    /// <summary>Error message if Success is false.</summary>
    public string? ErrorMessage { get; init; }

    /// <summary>Execution time for this step in milliseconds.</summary>
    public long ExecutionTimeMs { get; init; }

    /// <summary>Any warnings generated during execution.</summary>
    public IReadOnlyList<string>? Warnings { get; init; }
}
